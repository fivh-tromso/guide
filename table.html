<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CSV Data Table with Sorting</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
      background-color: #f9f9f9;
    }
    h1 {
      color: #333;
    }
    table#sortableTable {
      border-collapse: collapse;
      width: 100%;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    table#sortableTable th, table#sortableTable td {
      border: 1px solid #ddd;
      padding: 8px 12px;
      text-align: left;
      cursor: pointer;
      user-select: none;
    }
    table#sortableTable th {
      background-color: #f0f0f0;
      position: relative;
    }
    table#sortableTable tr:nth-child(even) {
      background-color: #fafafa;
    }
    /* Sort arrow */
    table#sortableTable th.asc::after {
      content: " ▲";
      position: absolute;
      right: 8px;
    }
    table#sortableTable th.desc::after {
      content: " ▼";
      position: absolute;
      right: 8px;
    }
    #table-container {
      margin-top: 15px;
    }
    .loading {
      font-style: italic;
      color: #666;
    }
    .error {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>CSV Data Table</h1>

  <div id="table-container">
    <span class="loading">Loading CSV data...</span>
  </div>

  <!-- Papa Parse CDN -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
    // Function to sort the table
    function makeTableSortable(tableId) {
      const table = document.getElementById(tableId);
      const headers = table.querySelectorAll('th');
      let sortDirections = Array(headers.length).fill(null);

      headers.forEach((th, index) => {
        th.addEventListener('click', () => {
          const currentDirection = sortDirections[index];
          const newDirection = currentDirection === 'asc' ? 'desc' : 'asc';
          sortDirections.fill(null);
          sortDirections[index] = newDirection;

          // Remove sort classes from all headers
          headers.forEach(h => h.classList.remove('asc', 'desc'));
          th.classList.add(newDirection);

          const tbody = table.querySelector('tbody');
          // Convert rows NodeList to array to sort it
          const rowsArray = Array.from(tbody.querySelectorAll('tr'));

          rowsArray.sort((rowA, rowB) => {
            const cellA = rowA.children[index].textContent.trim();
            const cellB = rowB.children[index].textContent.trim();

            // Check if numeric comparison
            const numA = parseFloat(cellA.replace(/[^0-9.-]+/g,""));
            const numB = parseFloat(cellB.replace(/[^0-9.-]+/g,""));

            if (!isNaN(numA) && !isNaN(numB)) {
              return newDirection === 'asc' ? numA - numB : numB - numA;
            }
            // Else string comparison
            return newDirection === 'asc'
              ? cellA.localeCompare(cellB)
              : cellB.localeCompare(cellA);
          });

          // Append sorted rows back to tbody
          rowsArray.forEach(row => tbody.appendChild(row));
        });
      });
    }

    // Fetch and parse CSV, then build and display table
    fetch('data.csv')
      .then(response => {
        if (!response.ok) throw new Error('Failed to load CSV');
        return response.text();
      })
      .then(csvText => {
        const parsed = Papa.parse(csvText.trim(), {
          skipEmptyLines: true,
        });
        if (!parsed.data.length) throw new Error('CSV is empty or invalid');

        let html = '<table id="sortableTable"><thead>';
        // First row as headers
        const headers = parsed.data[0];
        html += '<tr>';
        headers.forEach(header => {
          html += `<th>${header}</th>`;
        });
        html += '</tr></thead><tbody>';
        // Data rows
        for (let i = 1; i < parsed.data.length; i++) {
          const row = parsed.data[i];
          html += '<tr>';
          row.forEach(cell => {
            html += `<td>${cell}</td>`;
          });
          html += '</tr>';
        }
        html += '</tbody></table>';

        const container = document.getElementById('table-container');
        container.innerHTML = html;

        // Make table sortable
        makeTableSortable('sortableTable');
      })
      .catch(err => {
        document.getElementById('table-container').innerHTML =
          `<span class="error">Error loading the CSV file: ${err.message}</span>`;
      });
  </script>
</body>
</html>
